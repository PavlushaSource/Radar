# Инструменты

Выбран язык программирования Golang и [Fyne](https://github.com/fyne-io/fyne) UI toolkit для всего GUI.

# Архитектурная документация

В качестве ахитектурного шаблона приложения был выбран `MVVM`, поэтому приложение расделено на три
пакета `model`, `view` и `viewModel`.

## `model`

Пакет, содержащий модули движка и геометрии, а также модуль вспомогательных иструментов.

### `model/engine`

Пакет, содержащий реализацию обработки взаимодействий котов.

Публичные члены пакета:

- тип `Status`, псевдоним типа `int`. Работа с типом подразумевается через константы:
    - `Calm` — статус спокойного кота;
    - `Hissing` — статус шипящего кота;
    - `Fighting` — статус дерущегося кота;
- тип `Cat` является представлением кота с его статусом и координатами;
    - метод `Status()` возвращает статус текущего кота;
    - тип `Cat` включает в определение тип `Point` из `model/geom` и наследует все его публичные методы;
- тип `State` представляет состояние модели, содержащее множество котов;
    - метод `NumCats()` возвращает количество котов в состоянии;
    - метод `CatsElementAt(int)` возвращает кота (тип `*Cat`) по его индексу;
- тип `Engine` предсталяет движок, обрабатывающий взаимодействия котов;
    - метод `Run(context.Context)` принимает контекст и запускает движок, возвращая два буферизированных канала, для
      получения новых и возврата обработанных состояний;
        - Отмена контекста, приводит к остановке движка;
        - Нельзя запустить движок, повторно, до отмены контекста переданного при прошлом запуске;
        - Размер буфера каналов задаётся при создании движка;
- функция `NewEngine` возвращает новый движок с переданными параметрами. Принимает радиусы взаимодействий, количество
  котов, геометрию, асинхронный генератор случайный чисел и размер буффера каналов.

### `model/geom`

Пакет, содержащий реализацию различных геометрий модели и функций вычисления расстояния. Геометрии используются для
определения характера движения точек и параметризуются функцией расстояния, используемой для вычисления расстояния между
двумя точками.

TODO: Публичные члены пакета.

### `model/core/rnd`

Пакет, содержащий реализацию асинхронного генератора рандомных чисел с плавающей точкой, содержащихся на полуинтервале [
0, 1).

Публичные члены пакета:

- тип `RndAsync` — интерфейс генератора случайных чисел;
    - методы `Float64ByInt(int)` и `Float64ByFloat64(float64)` возвращают случайное число типа `float64` на
      полуинтервале [0, 1);
- функция `NewRndCore()` возвращает новый объект, реализующий интерфейс `RndAsync`.

## `viewModel`

Пакет, содержащий всё необходимое для связывания и конвертации типов с `engine` для отрисовки их на `UI`

- файл `converter` - в нём происходит конвертация типа `Cat` с `Engine` в промежуточный тип `Cat` из `Api` и затем
  в `CanvasObject`. Также в нём присутствуют другие конвертеры для связывания `model` и `view`
- файл `producer` - в нём реализован один из асинхронных паттернов взаимодействия для передачи объектов и
  конвертации `engine.Cat` в `CanvasObject` и асинхронной анимации с помощью `WaitGroup`.
    - Публичный метод `StartAppAction(ctx context.Context)` вызывает движок и следит за тем, чтобы `updateTime`
      введённый пользователем работал верно. Вся информация передаётся по каналам, что обеспечивает взаимоблокировку
      движка и UI в случае, если алгоритм будет работать медленно.

На диаграмме ниже представлена диаграмма зависимостей, которая удовлетворяет MVVM [определению](https://ru.wikipedia.org/wiki/Model-View-ViewModel)

![RadarSchema](https://github.com/user-attachments/assets/88fa4112-f0ae-4c59-95f9-e37ab233a977)

## `view`

Пакет, содержащий все типы, нужные для отрисовки меню конфигурации приложения и всей визуализации взаимодействия собак
на карте.

- тип `RadarSettings` содержит все параметры, которые вводятся в UI меню и передаются движку для создания через
  viewModel.
- тип `UIConfig` содержит все параметры, нужные для рисования объектов в UI.
- тип `DogsLayout` служит для расставления `CanvasObject` на экране в нужном размере и позиции
- тип `Loader` окно загрузки, всплывающее при долгом вызове `NewEngine`
- тип `RadarApplication` основа всего UI, в нём вызываются все функции по созданию `CanvasObject` таких как, toolbar,
  bottom bar и другие.

## `cmd`

В cmd представлены `main` пакеты запуска, которые являются точкой запуска программы. 
- `cmd/desktop/Desktop.go` файл запуска для всего приложения
- `cmd/engine/engine.go` отдельный запуск движка для бенчмаркинга
- `cmd/pattern.go` шпаргалка по паттерну, который был использован в `viewModel`

---
